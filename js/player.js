"use strict";function _construct(t,e,i){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(t,e,i){var n=[null];n.push.apply(n,e);e=new(Function.bind.apply(t,n));return i&&_setPrototypeOf(e,i.prototype),e}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var Player=function(){function e(){return _classCallCheck(this,e),this.getInstance.apply(this,arguments)}return _createClass(e,[{key:"getInstance",value:function(){var t=_construct(PlayerCreator,Array.prototype.slice.call(arguments));return e.instance=t}}]),e}(),Musics=function(){function t(){_classCallCheck(this,t),this.songs=[{id:1,title:"可能 - 李怡然同学",singer:"可能 - 李怡然同学",songUrl:"./songs/01.mp3",imageUrl:"https://imgessl.kugou.com/stdmusic/20220113/20220113180559306923.jpg"},{id:2,title:"寓言 - 希林娜依高",singer:"寓言 - 希林娜依高",songUrl:"./songs/02.mp3",imageUrl:"https://imgessl.kugou.com/stdmusic/20220517/20220517142502356923.jpg"}]}return _createClass(t,[{key:"getSongByNum",value:function(t){return this.songs[t]}}]),t}(),PlayerCreator=function(){function t(){_classCallCheck(this,t),this.audio=document.querySelector(".music-player__audio"),this.audio.volume=.2,this.util=new Util,this.musics=new Musics,this.song_index=0,this.loop_mode=1,this.song_list=$(".music__list_content"),this.render_doms={title:$(".music__info--title"),singer:$(".music__info--singer"),image:$(".music-player__image img"),blur:$(".music-player__blur")},this.ban_dom={control__btn:$(".control__volume--icon")},this.render_time={now:$(".nowTime"),total:$(".totalTime")},this.disc={image:$(".music-player__image"),pointer:$(".music-player__pointer")},this.init()}return _createClass(t,[{key:"init",value:function(){this.renderSongList(),this.renderSongStyle(),this.bindEventListener()}},{key:"renderSongList",value:function(){var i="";this.musics.songs.forEach(function(t,e){i+='<li class="music__list__item">'.concat(t.title,"</li>")}),this.song_list.html(i)}},{key:"renderSongStyle",value:function(){var t=this.musics.getSongByNum(this.song_index),e=t.title,i=t.singer,n=t.songUrl,t=t.imageUrl;this.audio.src=n,this.render_doms.title.html(e),this.render_doms.singer.html(i),this.render_doms.image.prop("src",t),this.render_doms.blur.css("background-image",'url("'+t+'")'),this.song_list.find(".music__list__item").eq(this.song_index).addClass("play").siblings().removeClass("play")}},{key:"bindEventListener",value:function(){var e=this;this.$play=new Btns(".player-control__btn--play",{click:this.handlePlayAndPause.bind(this)}),this.$prev=new Btns(".player-control__btn--prev",{click:this.changeSong.bind(this,"prev")}),this.$next=new Btns(".player-control__btn--next",{click:this.changeSong.bind(this,"next")}),this.$mode=new Btns(".player-control__btn--mode",{click:this.changePlayMode.bind(this)}),this.$ban=new Btns(".control__volume--icon",{click:this.banNotes.bind(this)}),this.song_list.on("click","li",function(t){t=$(t.target).index();e.changeSong(t)}),new Progress(".control__volume--progress",{min:0,max:1,value:this.audio.volume,handler:function(t){e.audio.volume=t}}),this.audio.oncanplay=function(){if(e.progress)return e.progress.max=e.audio.duration,e.render_time.total.html(e.util.formatTime(e.audio.duration)),!1;e.progress=new Progress(".player__song--progress",{min:0,max:e.audio.duration,value:0,handler:function(t){e.audio.currentTime=t}}),e.render_time.total.html(e.util.formatTime(e.audio.duration))},this.audio.ontimeupdate=function(){e.progress.setValue(e.audio.currentTime),e.render_time.now.html(e.util.formatTime(e.audio.currentTime))},this.audio.onended=function(){e.changeSong("next"),e.audio.play()}}},{key:"handlePlayAndPause",value:function(){var t=this.$play.$el.find("i");this.audio.paused?(this.audio.play(),t.removeClass("icon-play").addClass("icon-pause"),this.disc.image.addClass("play"),this.disc.pointer.addClass("play")):(this.audio.pause(),t.addClass("icon-play").removeClass("icon-pause"),this.disc.image.removeClass("play"),this.disc.pointer.removeClass("play"))}},{key:"changePlayMode",value:function(){this.loop_mode++,2<this.loop_mode&&(this.loop_mode=0),this.renderPlayMode()}},{key:"renderPlayMode",value:function(){this.$mode.$el.find("i").prop("class","iconfont icon-"+["loop","random","single"][this.loop_mode])}},{key:"changeSongIndex",value:function(t){if("number"==typeof t)this.song_index=t;else if(0===this.loop_mode)this.song_index+="next"===t?1:-1,this.song_index>this.musics.songs.length-1&&(this.song_index=0),this.song_index<0&&(this.song_index=this.musics.songs.length-1);else if(1===this.loop_mode)for(var e=this.musics.songs.length,i=Math.floor(Math.random()*e),n=0;n<1e4;n++){if(this.song_index!=i){this.song_index=i;break}i=Math.floor(Math.random()*e)}else 2===this.loop_mode&&(this.song_index=this.song_index)}},{key:"songTime",value:function(){var t=parseInt(this.audio.duration/60)<10?"0"+parseInt(this.audio.duration/60):parseInt(this.audio.duration/60),e=parseInt(this.audio.duration%60)<10?"0"+parseInt(this.audio.duration%60):parseInt(this.audio.duration%60);$(".totalTime").text(t+":"+e)}},{key:"changeSong",value:function(t){this.changeSongIndex(t);t=this.audio.paused;this.renderSongStyle(),t||this.audio.play()}},{key:"banNotes",value:function(){var t=this.$ban.$el.find("i");1==this.audio.muted?(this.audio.muted=!1,t.removeClass("icon-muted").addClass("icon-volume")):(this.audio.muted=!0,t.removeClass("icon-volume").addClass("icon-muted"))}}]),t}(),Progress=function(){function i(t,e){_classCallCheck(this,i),$.extend(this,e),this.$el=$(t),this.width=this.$el.width(),this.init()}return _createClass(i,[{key:"init",value:function(){this.renderBackAndPointer(),this.bindEvents(),this.drag(),this.value,this.changeDOMStyle(this.width*this.value)}},{key:"renderBackAndPointer",value:function(){this.$back=$('<div class="back">'),this.$pointer=$('<div class="pointer">'),this.$el.append(this.$back),this.$el.append(this.$pointer)}},{key:"setValue",value:function(t){t=this.width*t/(this.max-this.min);this.changeDOMStyle(t)}},{key:"drag",value:function(){var n=this,s=this.$pointer,o=this.$el,a=!1;s.mousedown(function(t){a=!0;var i=t.offsetX;$(document).mousemove(function(t){var e;!0===a&&(t=t.clientX-o.offset().left-i,e=(t=Math.max(0,Math.min(t,o.outerWidth(!1)-s.outerWidth(!1))))/o.outerWidth(!1)*(n.max-n.min),n.changeDOMStyle(t),n.handler(e))})}),$(document).mouseup(function(){a=!1})}},{key:"bindEvents",value:function(){var i=this;this.$el.click(function(t){var t=t.offsetX,e=t/i.width*(i.max-i.min);i.changeDOMStyle(t),i.handler(e)})}},{key:"changeDOMStyle",value:function(t){this.$back.width(t+7==7?0:t+7),this.$pointer.css("left",t+"px")}}]),i}(),Btns=function(){function i(t,e){_classCallCheck(this,i),this.$el=$(t),this.bindEvents(e)}return _createClass(i,[{key:"bindEvents",value:function(t){for(var e in t)t.hasOwnProperty(e)&&this.$el.on(e,t[e])}}]),i}();new Player,document.addEventListener("pjax:complete",function(t){new Player});